<template>
    <div>
        <div class="section">
            <div class="location">
                <span>当前位置：</span>
                <a href="/index.html">首页</a> &gt;
                <a href="/goods.html">购物商城</a> &gt;
                <a href="/goods/42/1.html">商品详情</a>
            </div>
        </div>
        <div class="section">
            <div class="wrapper clearfix">
                <div class="wrap-box">
                    <div class="left-925">
                        <div class="goods-box clearfix">
                            <div class="pic-box">
                                <ProductZoomer v-if="images.normal_size.length!=0" :base-images="images" :base-zoomer-options="zoomerOptions">
                                </ProductZoomer>
                            </div>
                            <div class="goods-spec">
                                <h1>{{goodsInfo.goodName}}</h1>
                                <p class="subtitle">{{goodsInfo.typeName}}</p>
                                <div class="spec-box">
                                    <dl>
                                        <dt>销售价</dt>
                                        <dd>
                                            <em id="commoditySellPrice" class="price">¥{{goodsInfo.price}}</em>
                                        </dd>
                                    </dl>
                                </div>
                                <div class="spec-box">
                                    <dl>
                                        <dd>
                                            <div id="buyButton" class="btn-buy">
                                                <button onclick="cartAdd(this,'/',1,'/shopping.html');" class="buy">立即购买</button>
                                                <button @click="addGoods" class="add">加入购物车</button>
                                            </div>
                                        </dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                        <div id="goodsTabs" class="goods-tab bg-wrap">
                            <Affix>
                                <div id="tabHead" class="tab-head" style="position: static; top: 517px; width: 925px;">
                                    <ul>
                                        <li>
                                            <a href="javascript:;" :class="{selected:isSelected}" @click="isSelected=true">商品介绍</a>
                                        </li>
                                    </ul>
                                </div>
                            </Affix>
                            <div class="tab-content entry" v-show="isSelected" v-html="goodsInfo.introduce">
                            </div>
                        </div>
                    </div>
                    <div class="left-220">
                        <div class="bg-wrap nobg">
                            <div class="sidebar-box">
                                <h4>推荐商品</h4>
                                <ul class="side-img-list">
                                    <li v-for="items in hotList" :key="items.goodId">
                                        <div class="img-box">
                                            <!-- <a href="#/site/goodsinfo/90" class=""> -->
                                            <router-link :to="'/detail/'+items.goodId">
                                                <img :src="items.img_url">
                                            </router-link>
                                            <!-- </a> -->
                                        </div>
                                        <div class="txt-box">
                                            <a href="#/site/goodsinfo/90" class="">{{items.goodName}}</a>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <BackTop></BackTop>
        <img v-if="imgList.length!=0" class="moveImg" :src="imgList[0].original_path" alt="">
    </div>
</template>
<script>
import { Loading } from "element-ui";
import $ from 'jquery';
export default {
    name: 'detail',
    data: function() {
        return {
            productId: undefined,
            goodsInfo: {},
            hotList: [],
            imgList: [],
            buyCount: '',
            isSelected: true,
            // 放大镜设置
            zoomerOptions: {
                'zoomFactor': 5, // 放大倍数
                'pane': 'container-round', // container-round 小放大镜
                'hoverDelay': 300,
                'namespace': 'zoomer',
                'move_by_click': true, // true 点击切换
                'scroll_items': 7,
                'choosed_thumb_border_color': "yellowgreen" // 框的颜色
            },
            // 轮播图用的图片 默认的数据格式 不支持
            // 这里的数据 需要在接口调用完毕之后 才能够获取
            images: {
                normal_size: []
            },
            pageNum: 1, //页码
            pageSize: 5, //页容量
            comments: [], //评论内容
            totalCount: 0, //评论总条数
            commentInfo: '' //评论内容
        }
    },
    methods: {
        //获取商品信息
        getProductDatil() {
            //获取Id
            this.productId = this.$route.params.id;
            //获取数据
             this.$axios.get(`/gemsell-api/goods/getById/${this.productId}`)
                .then(response => {
                    this.goodsInfo = response.data
                    this.imgList = this.goodsInfo.imgAddress;
                    // 处理 放大镜数据
                    let temArr = [];
                    // 循环处理数据
                    this.imgList.forEach((v, i) => {
                        temArr.push({
                            id: v.id,
                            url: v.original_path
                        })
                    })
                    // 临时数组 
                    this.images.normal_size = temArr;
                     this.buyCount = 1;
                });
                this.$axios
                    .post("/gemsell-api/goods/getListByCondition",data, 1,10)
                    .then(response => {
                        this.hotList = response.data;
                    });
        },
        //移动图片动画
        addGoods(){
            //获取加入购物车的位置
            let addOffset = $('.add').offset();
            //获取购物车的位置
            let carTarget = $('.icon-cart').offset();
            $('.moveImg').stop().show().addClass('move').css(addOffset).animate(carTarget,1000,function(){
                $(this).hide().removeClass('move');
            })

         this.$store.commit('addGoods',{
            goodId:this.productId,
            goodNum:this.buyCount
         });
        }
},
watch: {
        $route(val, oldVal) {
            // 数组长度为0 直接销毁 
            this.images.normal_size = [];
            // 回调函数中重新复制 再次 生成
            this.getProductDatil();
        }
    },
    created() {
        //加载动画
        const loading = this.$loading({
            lock: true,
            text: "Loading",
            spinner: "el-icon-loading",
            background: "rgba(0, 0, 0, 0.7)"
        });
        this.getProductDatil();
        //加载页面时获取第一页评论
        this.getCommentsInfo();
        //关闭加载动画
        let loadingInstance = Loading.service({ text: false });
        this.$nextTick(() => {
            // 以服务的方式调用的 Loading 需要异步关闭 
            loadingInstance.close();
        });
    }
}
</script>
<style lang='less'>
.tab-content img {
    width: 100%;
    height: 100%;
    display: block;
}

.pic-box {
    width: 395px;
    .control-box .thumb-list {
        display: flex;
        justify-content: center;
        img {
            width: 80px;
            height: 80px;
            margin: 2px;
        }
    }
    .control {
        //   text-align:center;
        display: flex; // 主轴
        justify-content: center; // 纵轴 副轴 侧轴
        align-items: center;
    }
}
// 移动图片的样式
.moveImg{
    position: absolute;
    width: 50px;
    height: 50px;
    display: none;
}
.moveImg.move{
    transition: transform 1s;
    transform: rotate(360deg) scale(.5);
}
</style>